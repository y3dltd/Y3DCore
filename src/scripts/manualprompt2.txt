**TASK:** Convert CSV order data into TSV format for production.

**INPUT CSV Columns (Indexed):**
0: Date - Ship By Date
1: Market - Markeplace Name
2: Item - SKU
3: Item - Name
4: Item - Qty
5: Order - Number
6: Bill To - Name
7: Carrier - Service Requested
8: Ship To - Country
9: Customer Email
10: Item - Price
11: Date - Order Date
12: Amount - Order Shipping
13: Amount - Order Tax
14: Amount - Order Total
15: Amount - Paid by Customer
16: Notes - From Buyer
17: Item - Options

**OUTPUT TSV Columns (Indexed):**
0: Date - Ship By Date (Source: CSV[0])
1: Market - Markeplace Name (Source: CSV[1])
2: Item - SKU (Source: CSV[2])
3: Item - Name (Extracted)
4: Item - Qty (Source: CSV[4])
5: Colour 1 (Extracted)
6: Colour 2 (Extracted)
7: Name (Extracted)
8: Status (Fixed: "pending")
9: Order - Number (Source: CSV[5])
10: Bill To - Name (Source: CSV[6])
11: Carrier - Service Requested (Source: CSV[7])
12: Ship To - Country (Source: CSV[8])
13: Customer Email (Source: CSV[9])
14: Item - Price (Source: CSV[10])
15: Date - Order Date (Source: CSV[11])
16: Amount - Order Shipping (Source: CSV[12])
17: Amount - Order Tax (Source: CSV[13])
18: Amount - Order Total (Source: CSV[14])
19: Amount - Paid by Customer (Source: CSV[15])

**EXTRACTION RULES:**

1.  **General Initialization:** For each CSV row:
    *   Set TSV[8] (Status) to "pending".
    *   Initialize TSV[5] (Colour 1), TSV[6] (Colour 2), and TSV[7] (Name) to empty strings.
    *   If CSV[2] (Item - SKU) is empty (e.g., a discount line), skip personalization extraction.

2.  **Marketplace-Specific Extraction:** Use the following logic, prioritizing Item - Options (CSV[17]) over Notes - From Buyer (CSV[16]) unless explicitly stated otherwise:

    *   **Amazon (Marketplace Name = "Amazon"):**
        *   Call `extract_amazon_personalization(CSV[17])` to populate Colour 1, Colour 2, and Name.

    *   **Etsy (Marketplace Name = "Etsy"):**
        *   Call `extract_etsy_personalization(CSV[17], CSV[16], CSV[4])` to populate Colour 1, Colour 2, and Name.  The Item Quantity (CSV[4]) needs to be used when extracting the fields to manage list numbers.

    *   **eBay (Marketplace Name = "eBay"):**
        *   Call `extract_ebay_personalization(CSV[2], CSV[17], CSV[16])` to populate Colour 1, Colour 2, and Name. Pass `Item - SKU` for the logic to better assign the appropriate colour if available.

3.  **Extraction Functions:** (Define each function in detail below)

    *   `extract_amazon_personalization(item_options)`:
        *   [Detailed Amazon extraction logic here, including pattern matching for "(Surface 1) Name or Text:...", etc.]

    *   `extract_etsy_personalization(item_options, notes_buyer, quantity)`:
        *   Prioritize extracting information from `item_options`.
        *   If `item_options` follows the pattern `"Color, Secondary Color, Personalization: Name"` (or similar), extract Colour 1, Colour 2, and Name accordingly.
        *   If `item_options` contains a list of names and colors (e.g., `"1. Isla - Purple\n2. Luke - Fire Engine Red..."`), extract *all* the names and colors, creating a single comma-separated string for the Name field and extracts *only* the first colour for the Colour 1 field.  *Do not attempt to create separate rows for each name*. Set colour one to the first colour found, ignoring any other colours.
        *   Remove any trailing "#number" suffixes from names.

    *   `extract_ebay_personalization(item_sku, item_options, notes_buyer)`:
        *   **Multi-Item Handling:** Parse all `Item ID: ... Text:` blocks in `notes_buyer`.
        *   **Color Association:**
            *   **Attempt SKU Matching:** For each `Item ID` block, if the `Item ID` *exactly matches* the input `item_sku`, extract its corresponding color (from `Variation: Color=...`) and associate it with the name extracted from the `Text:` field in that block. Set the name to blank if this is not found and add to review for manual review.
        *  **First Item If No Match** If a CSV rows sku doesn't match any text entry, use the first one. Set `"needsReview": true`  and provide `"reviewReason": "No matching Item ID in notes - manual review required"`.

4.  **Data Cleaning:**
    *   Trim whitespace from the beginning and end of TSV[5] (Colour 1), TSV[6] (Colour 2), and TSV[7] (Name).

5.  **Output Formatting:**
    *   Output each row as a single line of tab-separated values.
    *   Do *not* include a header row.
    *   Do *not* enclose fields in quotes unless the original data contained quotes and the field contains a tab character (highly unlikely).
    *   Retain the original format of `Date - Ship By Date` (CSV[0]).
```
With the assumption, that is is the exact match I think this should work. Now for sample output
04/09/2025 23:59,Etsy,PER-KEY3D-STY3-Y3D,Keychain/Keyring - 3D Printed- Personalised- Gifts for Children - Gifts for Her - Gifts for Him - Party Bag Fillers - Name Tags - School Bag,1,3650972755,Satvir Atwal,2-Day Shipping – 1-2 Working Days Delivery,GB,satviratwal@hotmail.com,2.99,04/07/2025 19:20,1.99,0,37.57,31.59,,"Light Blue, Secondary Matt Pink, Personalization: Arielle",,,,,
04/09/2025 23:59,Etsy,PER-KEY3D-STY1-Y3D,Keychain/Keyring - 3D Printed- Personalised- Gifts for Children - Gifts for Her - Gifts for Him - Party Bag Fillers - Name Tags - School Bag,3,3650987891,Lauryn Giannace,International Tracked – 3-5 Working Days Delivery,CA,lauryngiannace@gmail.com,1.99,04/07/2025 19:36,5.34,0,92.9,92.9,,"Beige, Personalization: 1. Ms.Claudia - Bone White
2. Ms.Adriana - Bone White
3. Sr.Adel - Bone White

*Please note period and capitalization for each.",,,,,
04/09/2025 23:59,Etsy,PER-KEY3D-STY1-Y3D,Keychain/Keyring - 3D Printed- Personalised- Gifts for Children - Gifts for Her - Gifts for Him - Party Bag Fillers - Name Tags - School Bag,41,3650987891,Lauryn Giannace,International Tracked – 3-5 Working Days Delivery,CA,lauryngiannace@gmail.com,1.99,04/07/2025 19:36,5.34,0,92.9,92.9,,"Purple, Personalization: 1. Isla - Purple
2. Luke - Fire Engine Red
3. Milena - Magenta
4. Marcus - Light Blue
5. Audrey - Yellow
6. Alba - Magenta
7. Max - Light Blue
8. Charlie - Peak Green
9. Max - Fire Engine Red
10. Sierra - Purple
11. Maya - Magenta
12. Claire - Magenta
13. Lorenzo - Orange
14. Joey - Peak Green
15. Matteo - Blue
16. Jack - Light Blue
17. Demi - Yellow
18. Ryan - Peak Green
19. Olivia - Purple
20. Leo - Orange
21. Theo - Peak Green
22. Joseph - Blue
23. Julian - Fire Engine R",,,,,
04/11/2025 23:59,eBay,wi_395107128418_19,3D Personalised Keyring - Party Bag / Gifts / Name Tags / School Bag / Travel,1,24-12925-48864,RICHARD ANTLEY,UK_RoyalMail48,GB,7c5f17336fa2d43a7a16@members.ebay.com,1.99,04/07/2025 20:39,0,0,7.96,7.16,"Personalisation:
Item ID: 395107128418 Variation: Color=Fire Engine Red
Text: HONDA VT250
Item ID: 395107128418 Variation: Color=Red
Text: RD125LC
Item ID: 395107128418 Variation: Color=Gold
Text: Honda VF400F
Item ID: 395107128418 Variation: Color=Dark Blue
Text: HONDA NC30",,,,,,
04/11/2025 23:59,eBay,wi_395107128418_3,3D Personalised Keyring - Party Bag / Gifts / Name Tags / School Bag / Travel,1,24-12925-48864,RICHARD ANTLEY,UK_RoyalMail48,GB,7c5f17336fa2d43a7a16@members.ebay.com,1.99,04/07/2025 20:39,0,0,7.96,7.16,"Personalisation:
Item ID: 395107128418 Variation: Color=Fire Engine Red
Text: HONDA VT250
Item ID: 395107128418 Variation: Color=Red
Text: RD125LC
Item ID: 395107128418 Variation: Color=Gold
Text: Honda VF400F
Item ID: 395107128418 Variation: Color=Dark Blue
Text: HONDA NC30",,,,,,
04/11/2025 23:59,eBay,wi_395107128418_22,3D Personalised Keyring - Party Bag / Gifts / Name Tags / School Bag / Travel,1,24-12925-48864,RICHARD ANTLEY,UK_RoyalMail48,GB,7c5f17336fa2d43a7a16@members.ebay.com,1.99,04/07/2025 20:39,0,0,7.96,7.16,"Personalisation:
Item ID: 395107128418 Variation: Color=Fire Engine Red
Text: HONDA VT250
Item ID: 395107128418 Variation: Color=Red
Text: RD125LC
Item ID: 395107128418 Variation: Color=Gold
Text: Honda VF400F
Item ID: 395107128418 Variation: Color=Dark Blue
Text: HONDA NC30",,,,,,
04/11/2025 23:59,eBay,wi_395107128418_7,3D Personalised Keyring - Party Bag / Gifts / Name Tags / School Bag / Travel,1,24-12925-48864,RICHARD ANTLEY,UK_RoyalMail48,GB,7c5f17336fa2d43a7a16@members.ebay.com,1.99,04/07/2025 20:39,0,0,7.96,7.16,"Personalisation:
Item ID: 395107128418 Variation: Color=Fire Engine Red
Text: HONDA VT250
Item ID: 395107128418 Variation: Color=Red
Text: RD125LC
Item ID: 395107128418 Variation: Color=Gold
Text: Honda VF400F
Item ID: 395107128418 Variation: Color=Dark Blue
Text: HONDA NC30",,,,,,
04/11/2025 23:59,eBay,PER-FIDSTA-LIG-4006-3-Y3D,Fidget Star Sensory Toy - Star 8 Point Fidget - Stress Relief -  Toys for Geeks,1,25-12909-60010,Natalie Smith,UK_RoyalMail48,GB,3e2f84288b82e2e8bf42@members.ebay.com,4.49,04/07/2025 20:31,0,0,4.49,4.49,,Light Blue,,,,,
04/09/2025 01:00,Amazon,PER-KEY3D-STY1-Y3D,1-Colour Keyring,1,205-0872107-5385108,Venus,Standard Std UK Dom_1,GB,wsvhwh1kx0sm0qt@marketplace.amazon.co.uk,2.49,04/07/2025 20:55,1.49,0.67,4.65,3.98,,"(Surface 1) Name or Text: Callum McClay, (Surface 1) Colour: Peak Green",,,,,https://zme-caps.amazon.com/t/ECeG7GBQTtGs/ErVlmgAXQ7u2X9QhIx41PddmdlAzTGA7YGSz0ojBBxU/23
